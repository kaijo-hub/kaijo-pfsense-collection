# pfSense SSH CrowdSec Parser (kaijo/sshd-logs-pfsense)

Version: 0.1.2  
Author: kaijo

A pfSense-optimized CrowdSec SSH parser providing full coverage for FreeBSD/pfSense SSH logs (sshd and sshd-session).

This parser is designed specifically for pfSense 24.x and 25.x, which use FreeBSD OpenSSH logging.  
It provides complete parsing for all SSH-related events generated by pfSense.

---

## Supported Log Types

The parser recognizes and processes the following pfSense SSH log formats:

- Accepted login  
- PAM authentication error  
- Permission denied  
- Timeout before authentication  
- Connection closed  
- Disconnect (with reason and reason_code)  
- sshguard (ignored intentionally)

This ensures full pfSense SSH coverage.

---

## Features

- Full support for all pfSense/FreeBSD SSH log formats  
- Works with both sshd and sshd-session  
- IPv4 and IPv6 support  
- Clean metadata output for CrowdSec scenarios  
- Compatible with CrowdSec 1.5+  
- Private IP ranges are automatically ignored by CrowdSec whitelists  
- No external dependencies

---

## Changes in Version 0.1.2

- Fixed PF_DISCONNECT pattern to support pfSense format  
  Example: `port 49695:11: Normal Shutdown`  
- Removed PF_SSHGUARD (not required, logs are excluded by filter)  
- Fully tested against real pfSense logs  
- Updated README  
- Prepared for CrowdSec Hub compatibility

---

## Installation

### Manual installation

cscli parsers install ./parsers/s01-parse/kaijo/sshd-logs-pfsense.yaml

### Installation via collection (recommended)

This repository includes a CrowdSec collection:
kaijo/pfsense-ssh

Install locally:
cscli collections install ./collections/kaijo-pfsense-ssh.yaml

Once published in the CrowdSec Hub:
cscli collections install kaijo/pfsense-ssh

### Example Logs from /var/log/auth.log

- Accepted keyboard-interactive/pam for admin from 192.168.1.10 port 54321 ssh2
- error: PAM: Authentication error for root from 192.168.1.10
- process_output: ssh_packet_write_poll: Connection from user admin 192.168.1.10 port 54321: Permission denied
- Timeout before authentication for connection from 192.168.1.10 to 192.168.1.1, pid = 12345
- Connection closed by 192.168.1.10 port 54321
- Received disconnect from 192.168.1.10 port 54321:11: Normal Shutdown

### Future Extensions

This repository will later include:

- pfSense OpenVPN parser
- pfSense SSH brute-force scenario
- pfSense security collection (kaijo/pfsense-security)

### Author

kaijo 
GitHub: https://github.com/kaijo-hub






